_format_version: "3.0"
_transform: true

services:
- name: login
  host: authentication-service # this name must be the same as the container name
  port: 5401 # this is the container port
  path: "/login" # this is the base path for the container
  protocol: http
  routes:
  - name: login
    paths:
      - /login # this is the kong path
    protocols:
      - http
      - https
- name: account
  host: authentication-service
  port: 5401
  path: "/account"
  protocol: http
  routes:
  - name: account
    paths:
      - /account
    protocols:
      - http
      - https
- name: post-management
  host: post-management
  port: 8084
  path: "/"
  protocol: http
  routes:
  - name: post
    paths:
      - /post
    protocols:
      - http
      - https
- name: user-management
  host: user-management
  port: 8084
  path: "/"
  protocol: http
  routes:
  - name: user
    paths:
      - /user
    protocols:
      - http
      - https
- name: reservation-management
  host: reservation-management
  port: 5007
  path: "/"
  protocol: http
  routes:
  - name: reservation
    paths:
      - /reservation
    protocols:
      - http
      - https

plugins:
- name: cors
  config: 
    origins:
    - "*"
    methods:
    - HEAD
    - GET
    - POST
    - PUT
    - PATCH
    - DELETE
    headers:
    - Access-Control-Allow-Origin
    - Accept
    - Accept-Version
    - Content-Length
    - Content-MD5
    - Content-Type
    - Date
    - Authorization
    exposed_headers:
    - Authorization
    credentials: true
    max_age: 3600
    preflight_continue: false
- name: authentication_plugin
  config:
    url: http://authentication-service:5401/account/me
    public_paths:
      - /user/loginuser
      - /user/createaccount
      - /post/viewposts
